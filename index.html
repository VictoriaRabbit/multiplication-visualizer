<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multiplication Practice Quiz</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; font-family: system-ui, -apple-system, sans-serif; }
        .celebration {
            animation: celebration 0.8s ease-in-out;
        }
        @keyframes celebration {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        // Icons
        const Play = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polygon points="5,3 19,12 5,21 5,3"></polygon>
            </svg>
        );
        
        const Pause = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <rect x="6" y="4" width="4" height="16"></rect>
                <rect x="14" y="4" width="4" height="16"></rect>
            </svg>
        );
        
        const RotateCcw = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="1,4 1,10 7,10"></polyline>
                <path d="M3.51,15a9,9,0,0,0,2.13,3.09,9,9,0,0,0,13.37,0,9,9,0,0,0,0-12.76,9,9,0,0,0-9.51-1.85"></path>
            </svg>
        );
        
        const Trophy = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path>
                <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path>
                <path d="M4 22h16"></path>
                <path d="M10 14.66V17c0 .55.47.98.97 1.21C11.56 18.75 12.23 19 13 19c.77 0 1.44-.25 2.03-.79.5-.23.97-.66.97-1.21v-2.34"></path>
                <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"></path>
            </svg>
        );

        const Star = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"></polygon>
            </svg>
        );

        const MultiplicationPractice = () => {
            const [num1, setNum1] = useState(4);
            const [num2, setNum2] = useState(6);
            const [userAnswer, setUserAnswer] = useState('');
            const [showReward, setShowReward] = useState(false);
            const [isCorrect, setIsCorrect] = useState(null);
            const [isAnimating, setIsAnimating] = useState(false);
            const [currentCount, setCurrentCount] = useState(0);
            const [colorMode, setColorMode] = useState('fill');
            const [isSelecting, setIsSelecting] = useState(false);
            const [selectionEnd, setSelectionEnd] = useState({ row: 0, col: 0 });
            const [isDragging, setIsDragging] = useState(false);
            const [animationSpeed, setAnimationSpeed] = useState(100);
            
            // Practice tracking
            const [practices, setPractices] = useState({
                singleDigit: 0,    // 1-9 Ã— 1-9
                doubleDigit: 0,    // 10-99 involved
                tripleDigit: 0     // 100+ involved
            });

            const maxSize = 50;
            const cellSize = Math.max(15, Math.min(25, 600 / Math.max(num1, num2)));
            const correctAnswer = num1 * num2;

            // Determine digit category
            const getDigitCategory = (n1, n2) => {
                const max = Math.max(n1, n2);
                if (max >= 100) return 'tripleDigit';
                if (max >= 10) return 'doubleDigit';
                return 'singleDigit';
            };

            // Generate new problem
            const generateNewProblem = () => {
                const newNum1 = Math.floor(Math.random() * 15) + 2; // 2-16
                const newNum2 = Math.floor(Math.random() * 15) + 2; // 2-16
                setNum1(newNum1);
                setNum2(newNum2);
                setUserAnswer('');
                setIsCorrect(null);
                setShowReward(false);
                resetAnimation();
            };

            const checkAnswer = () => {
                const userNum = parseInt(userAnswer);
                const category = getDigitCategory(num1, num2);
                
                if (userNum === correctAnswer) {
                    setIsCorrect(true);
                    setShowReward(true);
                    setPractices(prev => ({
                        ...prev,
                        [category]: prev[category] + 1
                    }));
                    
                    // Auto-generate new problem after celebration
                    setTimeout(() => {
                        generateNewProblem();
                    }, 2000);
                } else {
                    setIsCorrect(false);
                    setTimeout(() => {
                        setIsCorrect(null);
                    }, 1500);
                }
            };

            const handleKeyPress = (e) => {
                if (e.key === 'Enter' && userAnswer.trim() !== '' && !showReward) {
                    checkAnswer();
                }
            };

            // Animation logic
            useEffect(() => {
                if (isAnimating && currentCount < num1 * num2) {
                    const timer = setTimeout(() => {
                        setCurrentCount(prev => prev + 1);
                    }, animationSpeed);
                    return () => clearTimeout(timer);
                } else if (currentCount >= num1 * num2) {
                    setIsAnimating(false);
                }
            }, [isAnimating, currentCount, num1, num2, animationSpeed]);

            const startAnimation = () => {
                setCurrentCount(0);
                setIsAnimating(true);
            };

            const resetAnimation = () => {
                setIsAnimating(false);
                setCurrentCount(0);
            };

            const showAll = () => {
                setCurrentCount(num1 * num2);
                setIsAnimating(false);
            };

            const getCellColor = (index) => {
                const row = Math.floor(index / num2);
                const col = index % num2;
                const isInSelection = isSelecting && row <= selectionEnd.row && col <= selectionEnd.col;
                const isVisible = index < currentCount || (!isAnimating && currentCount === 0);
                
                if (isInSelection && !isAnimating) {
                    return 'bg-orange-300 border-orange-400 shadow-md';
                }
                
                if (!isVisible) return 'bg-gray-100 border-gray-200';
                
                if (colorMode === 'fill') {
                    return 'bg-blue-400 border-blue-500';
                } else if (colorMode === 'rainbow') {
                    const colors = [
                        'bg-red-400 border-red-500',
                        'bg-orange-400 border-orange-500',
                        'bg-yellow-400 border-yellow-500',
                        'bg-green-400 border-green-500',
                        'bg-blue-400 border-blue-500',
                        'bg-indigo-400 border-indigo-500',
                        'bg-purple-400 border-purple-500'
                    ];
                    return colors[index % colors.length];
                } else {
                    const colors = [
                        'bg-red-300 border-red-400',
                        'bg-blue-300 border-blue-400',
                        'bg-green-300 border-green-400',
                        'bg-yellow-300 border-yellow-400',
                        'bg-purple-300 border-purple-400',
                        'bg-pink-300 border-pink-400',
                        'bg-indigo-300 border-indigo-400'
                    ];
                    return colors[row % colors.length];
                }
            };

            const getCellBorderStyle = (index) => {
                const row = Math.floor(index / num2);
                const col = index % num2;
                
                let borderStyle = '';
                
                if (num2 > 10 && col === 9) {
                    borderStyle += ' border-r-4 border-r-black';
                }
                
                if (num1 > 10 && row === 9) {
                    borderStyle += ' border-b-4 border-b-black';
                }
                
                return borderStyle;
            };

            const handleCellMouseDown = (index) => {
                if (isAnimating) return;
                const row = Math.floor(index / num2);
                const col = index % num2;
                setSelectionEnd({ row, col });
                setIsSelecting(true);
                setIsDragging(true);
            };

            const handleCellMouseEnter = (index) => {
                if (isDragging && !isAnimating) {
                    const row = Math.floor(index / num2);
                    const col = index % num2;
                    setSelectionEnd({ row, col });
                }
            };

            const handleMouseUp = () => {
                setIsDragging(false);
            };

            const clearSelection = () => {
                setIsSelecting(false);
                setSelectionEnd({ row: 0, col: 0 });
            };

            useEffect(() => {
                document.addEventListener('mouseup', handleMouseUp);
                return () => document.removeEventListener('mouseup', handleMouseUp);
            }, []);

            const renderGrid = () => {
                const cells = [];
                let selectionCounter = 1;
                
                for (let i = 0; i < num1 * num2; i++) {
                    const row = Math.floor(i / num2);
                    const col = i % num2;
                    const isInSelection = isSelecting && row <= selectionEnd.row && col <= selectionEnd.col;
                    const isVisible = i < currentCount || (!isAnimating && currentCount === 0);
                    const showCellNumber = isVisible && (isInSelection || isAnimating);
                    
                    let cellNumber = i + 1;
                    if (isInSelection && !isAnimating) {
                        cellNumber = selectionCounter++;
                    }
                    
                    cells.push(
                        React.createElement('div', {
                            key: i,
                            className: `border-2 transition-all duration-200 flex items-center justify-center text-xs font-bold cursor-pointer select-none ${getCellColor(i)} ${getCellBorderStyle(i)}`,
                            style: {
                                width: cellSize,
                                height: cellSize,
                                fontSize: cellSize < 25 ? '8px' : '10px'
                            },
                            onMouseDown: () => handleCellMouseDown(i),
                            onMouseEnter: () => handleCellMouseEnter(i)
                        }, showCellNumber ? cellNumber : '')
                    );
                }
                return cells;
            };

            return React.createElement('div', {
                className: "min-h-screen bg-gradient-to-br from-indigo-50 to-purple-100 p-4"
            },
                React.createElement('div', { className: "max-w-6xl mx-auto" },
                    // Header
                    React.createElement('div', { className: "text-center mb-8" },
                        React.createElement('h1', { className: "text-4xl font-bold text-indigo-800 mb-2" }, "Multiplication Practice Quiz"),
                        React.createElement('p', { className: "text-indigo-600" }, "Solve problems and earn rewards!")
                    ),

                    // Practice Counter
                    React.createElement('div', { className: "bg-white rounded-lg p-4 shadow-md mb-6" },
                        React.createElement('h3', { className: "text-lg font-semibold text-gray-800 mb-3" }, "Practice Progress"),
                        React.createElement('div', { className: "grid grid-cols-3 gap-4" },
                            React.createElement('div', { className: "text-center p-3 bg-green-100 rounded-lg" },
                                React.createElement('div', { className: "text-2xl font-bold text-green-600" }, practices.singleDigit),
                                React.createElement('div', { className: "text-sm text-green-600" }, "Single Digit"),
                                React.createElement('div', { className: "text-xs text-gray-500" }, "1-9 Ã— 1-9")
                            ),
                            React.createElement('div', { className: "text-center p-3 bg-blue-100 rounded-lg" },
                                React.createElement('div', { className: "text-2xl font-bold text-blue-600" }, practices.doubleDigit),
                                React.createElement('div', { className: "text-sm text-blue-600" }, "Double Digit"),
                                React.createElement('div', { className: "text-xs text-gray-500" }, "10-99 involved")
                            ),
                            React.createElement('div', { className: "text-center p-3 bg-purple-100 rounded-lg" },
                                React.createElement('div', { className: "text-2xl font-bold text-purple-600" }, practices.tripleDigit),
                                React.createElement('div', { className: "text-sm text-purple-600" }, "Triple Digit"),
                                React.createElement('div', { className: "text-xs text-gray-500" }, "100+ involved")
                            )
                        )
                    ),

                    // Quiz Section
                    React.createElement('div', { className: "text-center mb-6" },
                        React.createElement('div', { 
                            className: `bg-white rounded-lg p-8 shadow-md inline-block ${showReward ? 'celebration' : ''}` 
                        },
                            React.createElement('div', { className: "text-5xl font-bold text-gray-800 mb-6 flex items-center justify-center gap-4" },
                                `${num1} Ã— ${num2} = `,
                                React.createElement('input', {
                                    type: "number",
                                    value: userAnswer,
                                    onChange: (e) => setUserAnswer(e.target.value),
                                    onKeyPress: handleKeyPress,
                                    className: `text-4xl text-center border-2 border-gray-300 rounded-lg px-4 py-2 w-32 focus:border-indigo-500 focus:outline-none ${
                                        isCorrect === true ? 'border-green-500 bg-green-50' : 
                                        isCorrect === false ? 'border-red-500 bg-red-50' : ''
                                    }`,
                                    placeholder: "?",
                                    disabled: showReward
                                })
                            ),

                            React.createElement('div', { className: "mb-4" },
                                React.createElement('button', {
                                    onClick: checkAnswer,
                                    disabled: userAnswer.trim() === '' || showReward,
                                    className: "bg-indigo-600 text-white px-8 py-3 rounded-lg font-semibold text-lg hover:bg-indigo-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors"
                                }, "Check Answer")
                            ),

                            // Feedback
                            isCorrect === true && showReward && React.createElement('div', { 
                                className: "mt-4 p-4 bg-green-100 text-green-800 rounded-lg flex items-center justify-center gap-2" 
                            },
                                React.createElement(Trophy),
                                React.createElement('span', { className: "text-xl font-bold" }, "ðŸŽ‰ Excellent! "),
                                Array.from({length: 5}, (_, i) => React.createElement(Star, { key: i, className: "text-yellow-500" }))
                            ),

                            isCorrect === false && React.createElement('div', { 
                                className: "mt-4 p-4 bg-red-100 text-red-800 rounded-lg" 
                            },
                                React.createElement('span', { className: "text-lg font-semibold" }, `Not quite! The answer is ${correctAnswer}`)
                            ),

                            React.createElement('div', { className: "mt-4" },
                                React.createElement('button', {
                                    onClick: generateNewProblem,
                                    className: "bg-green-600 text-white px-6 py-2 rounded-lg font-medium hover:bg-green-700 transition-colors"
                                }, "New Problem")
                            )
                        )
                    ),

                    // Visualization Controls
                    React.createElement('div', { className: "bg-white rounded-lg p-6 shadow-md mb-6" },
                        React.createElement('h3', { className: "text-lg font-semibold text-gray-700 mb-4" }, "Visual Helper"),
                        React.createElement('div', { className: "flex flex-wrap gap-3" },
                            React.createElement('button', {
                                onClick: startAnimation,
                                className: "bg-green-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-green-700 transition-colors flex items-center gap-2"
                            }, React.createElement(Play), "Count Units"),
                            
                            React.createElement('button', {
                                onClick: showAll,
                                className: "bg-purple-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-purple-700 transition-colors"
                            }, "Show All"),
                            
                            React.createElement('button', {
                                onClick: resetAnimation,
                                className: "bg-gray-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-gray-700 transition-colors flex items-center gap-2"
                            }, React.createElement(RotateCcw), "Reset"),
                            
                            React.createElement('button', {
                                onClick: clearSelection,
                                className: "bg-orange-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-orange-700 transition-colors"
                            }, "Clear Selection"),

                            React.createElement('select', {
                                value: colorMode,
                                onChange: (e) => setColorMode(e.target.value),
                                className: "px-4 py-2 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none"
                            },
                                React.createElement('option', { value: "fill" }, "Solid Blue"),
                                React.createElement('option', { value: "rows" }, "Row Colors"),
                                React.createElement('option', { value: "rainbow" }, "Rainbow")
                            )
                        )
                    ),
                    
                    // Grid Visualization
                    React.createElement('div', { className: "bg-white rounded-lg p-6 shadow-md" },
                        React.createElement('div', { className: "flex justify-center" },
                            React.createElement('div', { className: "inline-block" },
                                // Top numbers
                                React.createElement('div', { 
                                    className: "flex mb-2", 
                                    style: { marginLeft: cellSize * 0.8 + 8 + 16 } 
                                },
                                    Array.from({length: num2}, (_, i) => 
                                        React.createElement('div', {
                                            key: i,
                                            className: "flex items-center justify-center font-bold text-indigo-600",
                                            style: { 
                                                width: cellSize,
                                                height: cellSize * 0.6,
                                                fontSize: cellSize < 25 ? '12px' : '14px',
                                                marginRight: '4px'
                                            }
                                        }, i + 1)
                                    )
                                ),
                                
                                // Grid with left numbers
                                React.createElement('div', { className: "flex" },
                                    // Left numbers
                                    React.createElement('div', { 
                                        className: "flex flex-col", 
                                        style: { marginRight: '8px', paddingTop: '16px' } 
                                    },
                                        Array.from({length: num1}, (_, i) => 
                                            React.createElement('div', {
                                                key: i,
                                                className: "flex items-center justify-center font-bold text-indigo-600",
                                                style: { 
                                                    width: cellSize * 0.8,
                                                    height: cellSize,
                                                    fontSize: cellSize < 25 ? '12px' : '14px',
                                                    marginBottom: '4px'
                                                }
                                            }, i + 1)
                                        )
                                    ),
                                    
                                    // Main grid
                                    React.createElement('div', {
                                        className: "grid p-4 bg-gray-50 rounded-lg",
                                        style: { 
                                            gridTemplateColumns: `repeat(${num2}, 1fr)`,
                                            gap: '4px',
                                            maxWidth: '80vw',
                                            overflow: 'auto'
                                        }
                                    }, ...renderGrid())
                                )
                            )
                        ),
                        
                        // Grid info
                        React.createElement('div', { className: "mt-4 text-center text-sm text-gray-600" },
                            React.createElement('div', { className: "mb-2" },
                                React.createElement('span', { className: "inline-block bg-blue-100 px-3 py-1 rounded-full mr-4" }, `${num1} rows Ã— ${num2} columns`),
                                isSelecting && React.createElement('span', { className: "inline-block bg-orange-100 px-3 py-1 rounded-full" }, 
                                    `Selected: ${selectionEnd.row + 1} Ã— ${selectionEnd.col + 1} = ${(selectionEnd.row + 1) * (selectionEnd.col + 1)} cells`)
                            ),
                            React.createElement('div', { className: "text-xs text-gray-500" }, "Use the grid to visualize the multiplication!")
                        )
                    )
                )
            );
        };

        ReactDOM.render(React.createElement(MultiplicationPractice), document.getElementById('root'));
    </script>
</body>
</html>
